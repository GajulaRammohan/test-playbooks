---
- name: 'Deploy cloud hosts'
  hosts: local
  roles:
    - { role: deploy_cloud }

- name: 'Add authorized keys on database'
  hosts: 'database'
  roles:
    - role: auth_keys

- name: 'Dynamically create host groups'
  hosts: 'tower,primary'
  tasks:
   - name: group hosts by distribution_major_version
     group_by:
        key: "{{ansible_distribution}}-{{ansible_distribution_major_version}}"
     changed_when: false

- name: 'Install Tower'
  hosts: 'tower,primary'
  gather_facts: no
  become: true
  become_method: sudo
  roles:
    - { role: awx_setup }
