{% if 'tower' in groups %}
[tower]
localhost ansible_connection=local
{# {{ inventory_hostname }} ansible_user={{ hostvars[inventory_hostname]['ansible_user'] }} ansible_host={{ hostvars[inventory_hostname]['ansible_host'] }} #}
{% endif %}

{% if 'database' in groups %}
[database]
{% for host in groups['database'] %}
{{ host }} ansible_user={{ hostvars[host]['ansible_user'] }} ansible_host={{ hostvars[host]['ansible_host'] }}
{% endfor %}
{% endif %}

[all:vars]
{% if admin_password is defined %}
admin_password='{{ admin_password }}'
{% endif %}

{# Determine if using a remote postgres instance #}
{% if 'tower_db' in hostvars['127.0.0.1'] %}
pg_host="{{ hostvars['127.0.0.1']['tower_db']['pg_host'] }}"
pg_port="{{ hostvars['127.0.0.1']['tower_db']['pg_port'] }}"
pg_database="{{ hostvars['127.0.0.1']['tower_db']['pg_database'] }}"
pg_username="{{ hostvars['127.0.0.1']['tower_db']['pg_username'] }}"
pg_password="{{ hostvars['127.0.0.1']['tower_db']['pg_password'] }}"
pg_hashed_password="md5{{ (hostvars['127.0.0.1']['tower_db']['pg_password'] + "awx")|hash("md5") }}"
{% else %}
{% if 'database' in groups %}
pg_host="{{ groups['database'][0] }}"
pg_port="{{ pg_port|default(5432) }}"
{% endif %}
pg_database="{{ pg_database }}"
pg_username="{{ pg_username }}"
pg_password="{{ pg_password }}"
pg_hashed_password="md5{{ (pg_password + "awx")|hash("md5") }}"
{% endif %}

{% if 'tower' in groups %}
rabbitmq_port='{{ rabbitmq_port }}'
rabbitmq_vhost='{{ rabbitmq_vhost }}'
rabbitmq_username='{{ rabbitmq_username }}'
rabbitmq_password='{{ rabbitmq_password }}'
rabbitmq_use_long_name='{{ rabbitmq_use_long_name|bool|string|lower }}'
rabbitmq_cookie='{{ rabbitmq_cookie }}'
rabbitmq_enable_manager='{{ rabbitmq_enable_manager }}'
{% endif %}
