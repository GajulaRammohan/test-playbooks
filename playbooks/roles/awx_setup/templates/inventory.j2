{% if 'tower' in groups %}
[tower]
localhost ansible_connection=local
{# {{ inventory_hostname }} ansible_ssh_user={{ hostvars[inventory_hostname]['ansible_ssh_user'] }} ansible_ssh_host={{ hostvars[inventory_hostname]['ansible_ssh_host'] }} #}
{% endif %}

{% if 'primary' in groups %}
[primary]
localhost ansible_connection=local
{# {{ inventory_hostname }} ansible_ssh_user={{ hostvars[inventory_hostname]['ansible_ssh_user'] }} ansible_ssh_host={{ hostvars[inventory_hostname]['ansible_ssh_host'] }} #}
{% endif %}

{% if 'database' in groups %}
[database]
{% for host in groups['database'] %}
{{ host }} ansible_ssh_user={{ hostvars[host]['ansible_ssh_user'] }} ansible_ssh_host={{ hostvars[host]['ansible_ssh_host'] }}
{% endfor %}
{% endif %}

[all:vars]
{% if admin_password is defined %}
admin_password='{{ admin_password }}'
{% endif %}
{% if munin_password is defined %}
munin_password='{{ munin_password }}'
{% endif %}
{% if redis_password is defined %}
redis_password='{{ redis_password }}'
{% endif %}

{# Determine if using a remote postgres instance #}
{% if 'tower_db' in hostvars['127.0.0.1'] %}
pg_host="{{ hostvars['127.0.0.1']['tower_db']['pg_host'] }}"
pg_port="{{ hostvars['127.0.0.1']['tower_db']['pg_port'] }}"
pg_database="{{ hostvars['127.0.0.1']['tower_db']['pg_database'] }}"
pg_username="{{ hostvars['127.0.0.1']['tower_db']['pg_username'] }}"
pg_password="{{ hostvars['127.0.0.1']['tower_db']['pg_password'] }}"
{% else %}
{% if 'database' in groups %}
pg_host="{{ groups['database'][0] }}"
pg_port="{{ pg_port|default(5432) }}"
{% endif %}
pg_database="{{ pg_database }}"
pg_username="{{ pg_username }}"
pg_password="{{ pg_password }}"
{% endif %}

{# Determine if using a remote mongo instance #}
{% if 'mongodb' in groups and groups['mongodb']|length > 0 %}
{% set mongo_host=groups['mongodb'][0] %}
mongo_host="{{ mongo_host }}"
mongo_port="{{ hostvars[mongo_host]['mongo_port'] }}"
mongo_database="{{ hostvars[mongo_host]['mongo_database'] }}"
mongo_username="{{ hostvars[mongo_host]['mongo_username'] }}"
mongo_password="{{ hostvars[mongo_host]['mongo_password'] }}"
{% else %}
mongo_database="{{ mongo_database }}"
mongo_username="{{ mongo_username }}"
mongo_password="{{ mongo_password }}"
{% endif %}

{% if 'tower' in groups %} 
rabbitmq_port='{{ rabbitmq_port }}'
rabbitmq_vhost='{{ rabbitmq_vhost }}'
rabbitmq_username='{{ rabbitmq_username }}'
rabbitmq_password='{{ rabbitmq_password }}'
rabbitmq_use_long_name='{{ rabbitmq_use_long_name|bool|string|lower }}'
rabbitmq_cookie='{{ rabbitmq_cookie }}'
rabbitmq_enable_manager='{{ rabbitmq_enable_manager }}'
{% endif %}
