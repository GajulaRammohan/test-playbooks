{% for grp in groups %}
[{{ grp }}]
{% for host in groups[grp] %}
{% if host == '127.0.0.1' %}
{{ host }} ansible_connection=local ansible_python_interpreter=${VIRTUAL_ENV-/usr}/bin/python
{% elif hostvars[host]['ansible_ssh_password'] is defined %}
{{ host }} ansible_connection=winrm ansible_ssh_host={{ hostvars[host]['ansible_ssh_host'] }} ansible_ssh_user={{ hostvars[host]['ansible_ssh_user'] }} ansible_ssh_password='{{ hostvars[host]['ansible_ssh_password']|quote }}'
{% else %}
{{ host }} ansible_connection=winrm ansible_ssh_host={{ hostvars[host]['ansible_ssh_host'] }} ansible_ssh_user={{ hostvars[host]['ansible_ssh_user'] }}
{% endif %}
{% endfor %}

{% endfor %}
