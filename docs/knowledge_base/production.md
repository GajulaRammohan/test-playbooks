### How to Access Production Environments

The Tower QE team currently spins up production instances in the following configurations:
* Non-clustered, single instances on EC2 virtual machines, with a database on the same instance as the Tower server.
  * Comes in multiple linux distributions (RHEL, Ubuntu) and with different versions of Ansible.
* In a clustered environment on multiple EC2 virtual machines, with multiple traditional instances and isolated instances. With this configuration, postgres lives on its own VM.
* In a clustered environment in OpenShift, with multiple Tower pods. Our database here is in a separate ephemeral postgres pod.

If you want to build your own production instance, visit the following locations in Jenkins to kick off a new build job. You will need to be on the VPN to access Jenkins.
* [For single instance production environment](http://jenkins.ansible.eng.rdu2.redhat.com/view/Tower/job/Test_Tower_Install/)
* [For multiple instance clustered environment](http://jenkins.ansible.eng.rdu2.redhat.com/view/Tower/job/Test_Tower_Install_Cluster/)

For Tower in OpenShift, just click [here](https://ansible-tower-web-svc-tower-qe.openshift.ansible.eng.rdu2.redhat.com/).
  * You need to be on the VPN to access our Tower OpenShift environment.
  
To build a new Tower instance or cluster:
* Click the `Build with Parameters` button.
* Update `INSTANCE_NAME_PREFIX` to something unique (or else you may kill someone else's instances).
* Update `AW_REPO_URL` for whatever Tower version you want.
  * For Tower-3.3.0, use `http://nightlies.testing.ansible.com/ansible-tower_nightlies_m8u16fz56qr6q7/release_3.3.0`.
  * For Tower-3.2.6, use `http://nightlies.testing.ansible.com/ansible-tower_nightlies_m8u16fz56qr6q7/release_3.2.6`.
* If you want tests to run, keep `trigger` checked (you probably want to uncheck this).
* For `Test_Tower_Install` only, scroll to the bottom to the matrix view section (currently a 5x7 matrix). Keep checked the platform and Ansible version combination that you want.
  
For our production instances in EC2, we generate Ansible inventory files that contain a Tower web address and a username that you will need to ssh into that instance.
* This is a Jenkins artifact produced by our Jenkins jobs.
* For our single-VM setups, it is called `inventory.log`.
* For our multiple-VM setups, it is called `inventory.cluster`.

These look like this:
```
[all]
ec2-34-207-165-145.compute-1.amazonaws.com ansible_user=ubuntu ansible_host=ec2-34-207-165-145.compute-1.amazonaws.com
127.0.0.1 ansible_connection=local ansible_python_interpreter="/usr/bin/env python"

[local]
127.0.0.1 ansible_connection=local ansible_python_interpreter="/usr/bin/env python"

[ungrouped]

[ec2]
ec2-34-207-165-145.compute-1.amazonaws.com ansible_user=ubuntu ansible_host=ec2-34-207-165-145.compute-1.amazonaws.com

[instance_group_non_default]
ec2-34-207-165-145.compute-1.amazonaws.com ansible_user=ubuntu ansible_host=ec2-34-207-165-145.compute-1.amazonaws.com

[tower]
ec2-34-207-165-145.compute-1.amazonaws.com ansible_user=ubuntu ansible_host=ec2-34-207-165-145.compute-1.amazonaws.com

[ubuntu-16.04-x86_64]
ec2-34-207-165-145.compute-1.amazonaws.com ansible_user=ubuntu ansible_host=ec2-34-207-165-145.compute-1.amazonaws.com

[cloud]
ec2-34-207-165-145.compute-1.amazonaws.com ansible_user=ubuntu ansible_host=ec2-34-207-165-145.compute-1.amazonaws.com
```
* This file is generated by the jinja2 templating engine. Really what's important is the contents of `ansible_host` (your Tower web address) and `ansible_user` (ssh user).

After you access Tower via its web address, you will need to:
* Accept Tower's security certificate.
* Authenticate to Tower using the Tower login screen (ask a QE team member for credentials).
* Supply a valid Tower license. Either generate one yourself [here](https://github.com/ansible/tower-license) or ask a team member for a license.

Our Jenkins scripts add ssh public keys onto spawned EC2 instances. The list of added public keys is [here](https://github.com/ansible/tower-qa/blob/master/playbooks/roles/auth_keys/defaults/main.yml#L2). If you want to be included on this list, ask a QE team member.

Lastly, if you want to spin up your own Tower instance, the setup tarballs are here:
* For official releases, see [here](https://releases.ansible.com/ansible-tower/setup/).
* For development release tarballs, see [here](http://nightlies.testing.ansible.com/ansible-tower_nightlies_m8u16fz56qr6q7/).

Written by [Christopher Wang](mailto:chrwang@redhat.com) (Github: simfarm) July 11th, 2018.
